<html>
  <head>
    <title>tiff test</title>
    <script src="tiff.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/dojo/1.10.4/dojo/dojo.js"
            data-dojo-config="async: true"></script>
  </head>
  <body>
    <script>
     var file1 = 'CDD22.tif'; // small
     var file2 = 'CJQ15.tif'; // large
     require([
       'dojo/dom',
       'dojo/dom-construct',
       'dojo/request'
     ], function (dom, domConstruct, request) {
       Tiff.initialize({TOTAL_MEMORY: 1024*1024*32});
       
       request.get (
         file2,{ handleAs: 'arraybuffer'}).then (function (response){
           var tiff = new Tiff({buffer: response});
           var arrays = tiff.toArrays(callback);
         });

       function callback(image, y, width, height){
         var canvas = makeCanvasFromImage(image, width, height);
         document.body.appendChild(canvas);
       }

 
       function makeCanvasFromImage(image, width, height){
         var canvas = document.createElement('canvas');
         var context = canvas.getContext('2d');
         canvas.width = width;
         canvas.height = height;
         var imageData = context.createImageData(width, height);
         imageData.data.set(image);
         context.putImageData(imageData, 0, 0);
         return canvas;         
       }

     });
     

    </script>
  </body>
</html>
